(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(e,t,n){e.exports=n(34)},28:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var i=n(1),s=n.n(i),a=n(6),r=n.n(a),o=(n(28),n(3)),h=n(2),c=n(8),u=n(7),l=n(9),_=n(16),d=n(5),f=n(0),p=[],m={},g=window.innerWidth,v=window.innerHeight,y=!1;window.addEventListener("resize",function(){y||(y=!0,requestAnimationFrame(function(){g=window.innerWidth,v=window.innerHeight;for(var e=p.length,t=0;t<e;t++)p[t](g,v);y=!1}))});var k=[],w={};window.addEventListener("keydown",function(e){for(var t=e.key,n=k.length,i=0;i<n;i++)k[i](t)});var M=32,b=256,C=16*M,E=512,L=512,O=L*M,T=C>>1,S=M>>1;console.debug("MAP_TILES_WIDE",E),console.debug("CHUNK_PIXEL_LENGTH",C),console.assert(M%8===0,"You're gonna have a bad time.");var x=function(){function e(){Object(o.a)(this,e),this._sprites=new Array(b),this._scene=new f.t,this._target=new f.v(C,C,e.RENDER_TARGET_OPTIONS),this._material=new f.j(Object(d.a)({map:this._target.texture},e.MATERIAL_OPTIONS)),this._mesh=new f.i(e.GEOMETRY,this._material),this._currentSceneLocation={x:-1,y:-1},this._currentMapLocation={x:-1,y:-1},this._targetMapLocation={x:-1,y:-1},this._dirty=!1,this._target.texture.generateMipmaps=!1,this._mesh.position.z=0,this._fill()}return Object(h.a)(e,[{key:"_fill",value:function(){for(var e=this._sprites,t=0,n=0;n<16;n++)for(var i=0;i<16;i++){var s=new f.u;s.center.set(0,0),s.scale.set(M,M,1),s.position.set(i*M,n*M,1),this._scene.add(s),e[t++]=s}}},{key:"update",value:function(e,t){var n=this._targetMapLocation,i=n.x,s=n.y;if(this._currentMapLocation.x===i&&this._currentMapLocation.y===s)return this;for(var a,r=i*(16*E),o=16*s,h=this._sprites,c=0,u=0;u<16;u++){a=r+o+u*E;for(var l=0;l<16;l++){var _=h[c++],d=t[e[a++]];_.material!==d&&(_.material=d,this._dirty=!0)}}return this._currentMapLocation.x=i,this._currentMapLocation.y=s,this}},{key:"setChunkCoordinates",value:function(e,t){return this._targetMapLocation.x=e,this._targetMapLocation.y=t,this}},{key:"render",value:function(e,t){return!!this._dirty&&(e.setRenderTarget(this._target),e.render(this._scene,t),this._dirty=!1,!0)}},{key:"getMesh",value:function(){return this._mesh}},{key:"setSceneLocation",value:function(t,n,i){return this._currentSceneLocation.x!==t&&(this._currentSceneLocation.x=t,this._mesh.position.x=t*(C+e.CHUNK_DEBUG_SPACING)+T),this._currentSceneLocation.y!==n&&(this._currentSceneLocation.y=n,this._mesh.position.y=i+T-(n+1)*(C+e.CHUNK_DEBUG_SPACING)),this}},{key:"dispose",value:function(){this._target.dispose(),this._material.dispose(),this._target=null,this._material=null,this._mesh=null,this._scene=null,this._sprites=null}}]),e}();x.CHUNK_DEBUG_SPACING=0,x.MATERIAL_OPTIONS={blending:f.m,side:f.g},x.RENDER_TARGET_OPTIONS={magFilter:f.l,minFilter:f.l,format:f.s,depthBuffer:!1,stencilBuffer:!1},x.GEOMETRY=new f.q(C,C);var R=function(){function e(t,n){Object(o.a)(this,e),this._camera=new f.o(0,C,C,0,-1,2e3),this._chunks=[],this._chunksWide=0,this._chunksHigh=0,this._topLeftChunkCoordinate={top:-1,left:-1},this._materialArray=null,this._map=null,this._sceneDimensions={width:0,height:0},this._camera.position.z=1,this._camera.position.x=0,this._camera.position.y=0,this._camera.updateProjectionMatrix(),this._materialArray=n.getMaterialArray(),this._map=t}return Object(h.a)(e,[{key:"reorientChunks",value:function(){for(var e=this.chunksWide(),t=this._chunks,n=t.length,i=this._sceneDimensions.height,s=this._materialArray,a=this._map,r=0;r<n;r++){var o=r%e,h=Math.floor(r/e);t[r].update(a,s).setSceneLocation(o,h,i)}}},{key:"resize",value:function(e,t,n){var i=Math.ceil(e/C)+2,s=Math.ceil(t/C)+2,a=this._chunks.length,r=i*s;if(this._chunksHigh=s,this._chunksWide=i,this._sceneDimensions.width=i*C,this._sceneDimensions.height=s*C,a!==r){var o=Math.abs(a-r);if(a>r)this._chunks.splice(r,o).forEach(function(e){n.remove(e.getMesh()),e.dispose()}),console.log("Destroyed",o,"chunks (",r,")");else{for(var h=a;h<r;h++){var c=new x;this._chunks.push(c),n.add(c.getMesh())}console.log("Created",o,"chunks (",i,"x",s,", total:",r,")")}}var u=this._topLeftChunkCoordinate,l=u.left,_=u.top;this.setLeftTop(l,_)}},{key:"setLeftTop",value:function(e,t){var n=this.chunksWide(),i=this.chunksHigh(),s=n*i,a="setLeftTop(".concat(e,", ").concat(t,") : ").concat(s);console.time(a);for(var r=0,o=t;o<t+i;o++)for(var h=e;h<e+n;h++)this._chunks[r++].setChunkCoordinates(h,o);this._topLeftChunkCoordinate.left=e,this._topLeftChunkCoordinate.top=t,this.reorientChunks(),console.timeEnd(a)}},{key:"panUp",value:function(){var e=Math.max(0,this._topLeftChunkCoordinate.top-1);if(e===this._topLeftChunkCoordinate.top)return!1;for(var t=this.chunksWide(),n=this.chunksHigh(),i=this._topLeftChunkCoordinate.left,s=t*(n-1),a=this._chunks.splice(s,t),r=0;r<t;r++)a[r].setChunkCoordinates(i+r,e);return this._chunks=a.concat(this._chunks),this._topLeftChunkCoordinate.top=e,!0}},{key:"panDown",value:function(){var e=32-this.chunksHigh(),t=Math.min(e,this._topLeftChunkCoordinate.top+1);if(t===this._topLeftChunkCoordinate.top)return!1;for(var n=this.chunksWide(),i=this._topLeftChunkCoordinate.left,s=this._chunks.splice(0,n),a=t+this.chunksHigh()-1,r=0;r<n;r++)s[r].setChunkCoordinates(i+r,a);return this._chunks=this._chunks.concat(s),this._topLeftChunkCoordinate.top=t,!0}},{key:"panRight",value:function(){var e=this.chunksWide(),t=Math.min(32-e,this._topLeftChunkCoordinate.left+1);if(t===this._topLeftChunkCoordinate.left)return!1;for(var n=this.chunksHigh(),i=this._topLeftChunkCoordinate.top,s=this._chunks,a=t+e-1,r=0;r<n;r++){var o=r*e,h=s[o].setChunkCoordinates(a,i+r);s.splice(o,1),s.splice(o+(e-1),0,h)}return this._topLeftChunkCoordinate.left=t,!0}},{key:"panLeft",value:function(){var e=Math.max(0,this._topLeftChunkCoordinate.left-1);if(e===this._topLeftChunkCoordinate.left)return!1;for(var t=this.chunksWide(),n=this.chunksHigh(),i=this._topLeftChunkCoordinate.top,s=this._chunks,a=0;a<n;a++){var r=a*t+(t-1),o=s[r].setChunkCoordinates(e,i+a);s.splice(r,1),s.splice(a*t,0,o)}return this._topLeftChunkCoordinate.left=e,!0}},{key:"update",value:function(e){console.timeStamp("ChunkRenderer#update");for(var t=performance.now(),n=this._chunks,i=n.length,s=this._camera,a=0,r=0;r<i;r++)n[r].render(e,s)&&a++;if(a){var o=performance.now();console.debug("Updated",a,"chunks in",o-t,"ms")}}},{key:"dispose",value:function(){this._chunks.forEach(function(e){return e.dispose()}),this._chunks=null}},{key:"chunksWide",value:function(){return this._chunksWide}},{key:"chunksHigh",value:function(){return this._chunksHigh}},{key:"sceneDimensions",value:function(){return this._sceneDimensions}},{key:"top",value:function(){return this._topLeftChunkCoordinate.top}},{key:"left",value:function(){return this._topLeftChunkCoordinate.left}}]),e}(),j=n(17),D=new(n.n(j).a);var P=window.hasOwnProperty("OffscreenCanvas"),I=function(){try{var e=document.createElement("canvas");return!(!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}(),U=function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(t){return!1}}();var A=n(4),N=function(){function e(){Object(o.a)(this,e),this._material=new Array(e.MAX_TEXTURE_COUNT),this._currentArrayPosition=0,this._materialSet=new Set}return Object(h.a)(e,[{key:"newCanvasTexture",value:function(e){var t=new A.a(e,A.f,A.b,A.b,A.c,A.c,A.d,A.g,1);t.generateMipmaps=!1;var n=new A.e({map:t});return this._material[this._currentArrayPosition++]=n,this._materialSet.add(n),n}},{key:"newTileForColor",value:function(e,t,n){var i,s,a=(i=M,s=M,P?new OffscreenCanvas(i,s):document.createElement("canvas")),r=a.getContext("2d",{alpha:!1});return r.fillStyle="rgb(".concat(e,", ").concat(t,", ").concat(n,")"),r.fillRect(0,0,M,M),this.newCanvasTexture(a)}},{key:"greenTile",value:function(e){return this.newTileForColor(0,100+Math.floor(150*e),0)}},{key:"getMaterialArray",value:function(){return this._material}},{key:"size",value:function(){return this._materialSet.size}},{key:"dispose",value:function(){this._materialSet.forEach(function(e){return e.map.dispose()}),this._materialSet=null,this._material=null}}]),e}();N.MAX_TEXTURE_COUNT=16384;var B=n(10),H=n.n(B),W=function(){function e(){Object(o.a)(this,e),this._array=null,this._set=new Set,this._group=new f.h,this._array=new Array(E*L),this._group.position.set(0,0,2)}return Object(h.a)(e,[{key:"group",value:function(){return this._group}},{key:"add",value:function(e){this._set.add(e),this._group.add(e.mesh())}},{key:"remove",value:function(e){return!!this._set.delete(e)&&(this._array[e.worldMapArrayIndex()]=void 0,this._group.remove(e.mesh()),e.dispose(),!0)}},{key:"offsetForChunkRenderer",value:function(e){var t=-e.left()*C,n=e.top()*C+e.sceneDimensions().height,i=O-n;return this._group.position.x=t,this._group.position.y=-i,this}},{key:"z",value:function(e){return!e||e<2?this._group.position.z:e===this._group.position.z?this:(this._set.forEach(function(t){return t.z(e)}),this._group.position.z=e,this)}},{key:"dispose",value:function(){var e=this;this._set.forEach(function(t){return e.remove(t)}),this._set=null,this._array=null}}]),e}(),Y=function(){function e(){Object(o.a)(this,e),this._materialSet=new Set}return Object(h.a)(e,[{key:"addMaterial",value:function(t){return this._materialSet.has(t)?this:(console.assert(this._materialSet.size<e.MAX_TEXTURE_COUNT),this._materialSet.add(t),this)}},{key:"newMaterial",value:function(t){var n=new f.j(Object(d.a)({},t,e.OPTIONS));return this.addMaterial(n),n}},{key:"dispose",value:function(){this._materialSet.forEach(function(e){e.hasOwnProperty("map")&&e.map&&e.map.dispose()}),this._materialSet=null}}]),e}();Y.MAX_TEXTURE_COUNT=16384,Y.OPTIONS={side:f.g};var z=function(){function e(t){Object(o.a)(this,e),this._worldPosition={x:-1,y:-1},this._mesh=new f.i(e.SINGLE_TILE_GEOMETRY),this._mesh.position.z=t&&t>2?t:2}return Object(h.a)(e,[{key:"z",value:function(e){return!e||e<2?this._mesh.position.z:(this._mesh.position.z=e,this)}},{key:"texture",value:function(e){return e?(this.material().map=e,this):this.material().map}},{key:"material",value:function(e){return e?(this._mesh.material=e,this):this._mesh.material}},{key:"setWorldPosition",value:function(e,t){return console.assert(e>=0&&e<E),console.assert(t>=0&&t<L),this._worldPosition.x=e,this._worldPosition.y=t,this._mesh.position.x=e*M+S,this._mesh.position.y=O-t*M-S,this}},{key:"mesh",value:function(){return this._mesh}},{key:"worldMapArrayIndex",value:function(){return this._worldPosition.y*E+this._worldPosition.x}},{key:"dispose",value:function(){this._mesh.geometry!==e.SINGLE_TILE_GEOMETRY&&this._mesh.geometry.dispose(),this._mesh=null}}]),e}();z.SINGLE_TILE_GEOMETRY=new f.q(M,M);var G=function(){function e(){Object(o.a)(this,e),this._geom=null,this._target=null,this._mesh=new f.i(new f.q(1,1),new f.k({shininess:0,flatShading:!0,specular:0,reflectivity:0})),this._scene=new f.t,this._camera=new f.o(0,1,0,1,-1,10),this._dirty=!1,this._ambientLight=new f.b("white",.5),this._sceneObject=new f.i,this._mesh.position.set(0,0,0),this._mesh.receiveShadow=!0,this._mesh.castShadow=!1,this._scene.add(this._mesh),this._camera.position.set(0,0,5),this._light=new f.r("white",6,0),this._light.castShadow=!0,this._light.shadow.mapSize.x=64,this._light.shadow.mapSize.y=64,this._scene.add(this._light),this._scene.add(this._ambientLight),this._cube=e._generateWall(10,1),this._scene.add(this._cube),this._sceneObject.material=new f.j({side:f.g,transparent:!0,blending:f.e,blendEquation:f.a,blendSrc:f.f,blendDst:f.n}),this.resize(64,64)}return Object(h.a)(e,null,[{key:"_generateWall",value:function(e,t){var n=new f.c(e,t,10),i=new f.j({color:"blue"}),s=new f.i(n,i);return s.castShadow=!0,s.receiveShadow=!1,s}}]),Object(h.a)(e,[{key:"offsetAmbientLightIntensity",value:function(e){this._ambientLight.intensity+=e,this._dirty=!0}},{key:"resize",value:function(t,n){var i=Math.ceil(t/M),s=Math.ceil(n/M);this._target&&this._target.dispose(),this._target=new f.v(i,s,e.RENDER_TARGET_OPTIONS),console.log("shadow render target:",i,s),this._target.texture.generateMipmaps=!1,this._mesh.geometry.dispose(),this._mesh.geometry=new f.q(i,s),this._mesh.position.x=i,this._mesh.position.y=s,this._cube.position.set(i-2,s-2,0),this._light.position.set(i,s,1),this._camera.right=i,this._camera.top=s,this._camera.position.x=i/2,this._camera.position.y=s/2,this._camera.updateProjectionMatrix(),this._sceneObject.geometry.dispose(),this._sceneObject.geometry=new f.q(t,n),this._sceneObject.material.map=this._target.texture,this._sceneObject.position.set(t/2,n/2,100),this._dirty=!0}},{key:"lightPos",value:function(e,t){this._light.position.set(e/M,t/M,1),this._dirty=!0}},{key:"render",value:function(e){this._dirty&&(e.setRenderTarget(this._target),e.shadowMap.enabled=!0,e.render(this._scene,this._camera),e.shadowMap.enabled=!1,this._dirty=!1)}},{key:"dispose",value:function(){this._geom.dispose(),this._target.dispose(),this._geom=null,this._target=null}},{key:"sceneObject",value:function(){return this._sceneObject}}]),e}();G.RENDER_TARGET_OPTIONS={magFilter:f.l,stencilBuffer:!1,depthBuffer:!1,antialias:!1};var F=function(){function e(t){var n=this;Object(o.a)(this,e),this._scene=new f.t,this._camera=new f.o(1,1,1,1,0,1),this._index=e._rendererCount++,this._rendering=!1,this._cameraDelta={x:0,y:0},this._tileMaterials=new N,this._map=new Int16Array(E*L),this._chunkRenderer=new R(this._map,this._tileMaterials),this._renderer=null,this._context=null,this._canvas=null,this._cameraWorldTile={x:0,y:0},this._panBoundary={offset:0,top:0,left:0,right:0,bottom:0},this._offMapBoundary={top:0,left:0,bottom:0,right:0},this._distanceAllowedToPanOffMap=2*M,this._tileHighlighter=null,this._tileSelector=null,this._allowMapDragWithMouse=!0,this._mouseDownLocation=null,this._backgroundColor=new f.d(5334682),this._cameraTween=null,this._objectMaterials=new Y,this._objects=new W,this._lighting=new G,this._showLighting=!0,this._mouseMoveHandler=function(e){var t=e.offsetX,i=e.offsetY;if(n._mouseDownLocation&&n._allowMapDragWithMouse)return n.stopCurrentCameraTween(),n._cameraDelta.x+=n._mouseDownLocation.x-t,n._cameraDelta.y+=i-n._mouseDownLocation.y,n._mouseDownLocation.x=t,void(n._mouseDownLocation.y=i);var s=n.windowOffsetToSceneCoordinate(t,i),a=s.sceneX,r=s.sceneY;n._lighting.lightPos(a+n.width(),r+n.height());var o=n.worldTileForSceneCoordinate(a,r),h=o.x,c=o.y;n._tileHighlighter.setWorldPosition(Math.floor(h),Math.floor(c))},this._mouseDownHandler=function(e){var t=e.offsetX,i=e.offsetY;n._mouseDownLocation={x:t,y:i}},this._mouseUpHandler=function(){n._mouseDownLocation=null},this._clickHandler=function(e){var t=e.offsetX,i=e.offsetY,s=n.windowOffsetToSceneCoordinate(t,i),a=s.sceneX,r=s.sceneY,o=n.worldTileForSceneCoordinate(a,r),h=o.x,c=o.y;n._tileSelector.setWorldPosition(Math.floor(h),Math.floor(c))},this._doubleClickHandler=function(e){var t=e.offsetX,i=e.offsetY,s=n.windowOffsetToSceneCoordinate(t,i),a=s.sceneX,r=s.sceneY;console.log("Picked tile:",n.worldTileForSceneCoordinate(a,r));var o=r-r%M+M/2,h={x:a-a%M+M/2-n.width()/2,y:o-n.height()/2};n.tweenCameraToSceneCoordinate(h)},this.resize=function(e,t){n._renderer.setSize(e,t),n._camera.left=0,n._camera.right=e,n._camera.top=t,n._camera.bottom=0,n._camera.near=-1,n._camera.far=2e3,n._camera.updateProjectionMatrix(),n._chunkRenderer.resize(e,t,n._scene),n._objects.offsetForChunkRenderer(n._chunkRenderer);var i=n._chunkRenderer.sceneDimensions(),s=i.width,a=i.height;n._lighting.resize(s,a),n._panBoundary.offset=C,n._panBoundary.top=a-t,n._panBoundary.bottom=0,n._panBoundary.left=0,n._panBoundary.right=s-e;var r=n._distanceAllowedToPanOffMap;n._offMapBoundary.left=-r,n._offMapBoundary.right=s-(e-r),n._offMapBoundary.top=a-(t-r),n._offMapBoundary.bottom=-r},this.keydown=function(t){var i=0,s=0;switch(t){case"8":case"w":i+=e.KEY_JUMP_SIZE;break;case"2":case"s":i-=e.KEY_JUMP_SIZE;break;case"4":case"a":s-=e.KEY_JUMP_SIZE;break;case"6":case"d":s+=e.KEY_JUMP_SIZE;break;case"7":i+=e.KEY_JUMP_SIZE,s-=e.KEY_JUMP_SIZE;break;case"9":i+=e.KEY_JUMP_SIZE,s+=e.KEY_JUMP_SIZE;break;case"1":i-=e.KEY_JUMP_SIZE,s-=e.KEY_JUMP_SIZE;break;case"3":i-=e.KEY_JUMP_SIZE,s+=e.KEY_JUMP_SIZE;break;case"l":n._showLighting=!n._showLighting,n._showLighting?n._scene.add(n._lighting.sceneObject()):n._scene.remove(n._lighting.sceneObject());break;case"+":n._lighting.offsetAmbientLightIntensity(.05);break;case"-":n._lighting.offsetAmbientLightIntensity(-.05);break;case" ":n.toggleRendering();break;default:console.debug("Unhandled key",t)}(s||i)&&(n.stopCurrentCameraTween(),n._cameraDelta.x+=s,n._cameraDelta.y+=i)},this.render=function(e){n._rendering||(n._renderer.setAnimationLoop(null),console.log("Rendering stopped.")),D.begin(),H.a.update(e),n._applyCameraDelta(),n._lighting.render(n._renderer),n._chunkRenderer.update(n._renderer),n._renderer.setRenderTarget(null),n._renderer.render(n._scene,n._camera),D.end()},this._canvas=t,this._context=function(e){return e.getContext(U?"webgl2":"webgl")}(this._canvas),this._renderer=new f.w(Object(d.a)({canvas:t,context:this._context},e.RENDERER_OPTIONS)),this._scene.background=this._backgroundColor,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.shadowMap.type=f.p,this._camera.position.z=100,this._scene.add(this._objects.group()),this._scene.add(this._lighting.sceneObject()),this._initTileMaterials(),this._initSparseObjects()}return Object(h.a)(e,[{key:"_initTileMaterials",value:function(){for(var e=0;e<9;e+=1)this._tileMaterials.greenTile(.005*e)}},{key:"_initSparseObjects",value:function(){var e=this._objectMaterials.newMaterial({color:16776960,opacity:.55,transparent:!0});this._tileHighlighter=new z(5),this._tileHighlighter.material(e).setWorldPosition(0,0),this._objects.add(this._tileHighlighter);var t=this._objectMaterials.newMaterial({color:255,opacity:.55,transparent:!0});this._tileSelector=new z(3),this._tileSelector.material(t).setWorldPosition(0,0),this._objects.add(this._tileSelector)}},{key:"addManyRandomBlueObjects",value:function(){for(var e=this._objectMaterials.newMaterial({color:255,opacity:.55,transparent:!0}),t=0;t<16e3;t++)this._objects.add(new z(2).material(e).setWorldPosition(Math.floor(Math.random()*E),Math.floor(Math.random()*L)))}},{key:"windowOffsetToSceneCoordinate",value:function(e,t){return{sceneX:this._camera.position.x+e,sceneY:this._camera.position.y+this.height()-t}}},{key:"stopCurrentCameraTween",value:function(){this._cameraTween&&(this._cameraTween.stop(),this._cameraTween=null)}},{key:"tweenCameraToSceneCoordinate",value:function(e){var t=this;this._cameraDelta.x=0,this._cameraDelta.y=0,this.stopCurrentCameraTween();var n={x:this._camera.position.x,y:this._camera.position.y},i=Object(d.a)({},n);this._cameraTween=new H.a.Tween(n).to(e,1e3).easing(H.a.Easing.Quadratic.Out).onUpdate(function(){t._cameraDelta.x+=n.x-i.x,t._cameraDelta.y+=n.y-i.y,i.x=n.x,i.y=n.y}).start()}},{key:"listenForMouseEvents",value:function(){this._canvas.addEventListener("mousemove",this._mouseMoveHandler),this._canvas.addEventListener("mousedown",this._mouseDownHandler),this._canvas.addEventListener("mouseup",this._mouseUpHandler),this._canvas.addEventListener("click",this._clickHandler),this._canvas.addEventListener("dblclick",this._doubleClickHandler)}},{key:"stopListeningForMouseEvents",value:function(){this._canvas.removeEventListener("mousemove",this._mouseMoveHandler),this._canvas.removeEventListener("mousedown",this._mouseDownHandler),this._canvas.removeEventListener("mouseup",this._mouseUpHandler),this._canvas.removeEventListener("dblclick",this._doubleClickHandler)}},{key:"name",value:function(){return"renderer-"+this._index}},{key:"generateTestMap",value:function(){for(var e=this._map,t=e.length;t>=0;t--){var n=t%E,i=Math.floor(t/E)%16,s=n%16;e[t]=0===i||15===i?0:0===s||15===s?4:8}}},{key:"generateMap",value:function(){for(var e=this._map,t=e.length,n=this._tileMaterials.size(),i=t;i>=0;i--)e[i]=Math.floor(Math.random()*n)}},{key:"width",value:function(){return this._camera.right}},{key:"height",value:function(){return this._camera.top}},{key:"destroy",value:function(){this._rendering=!1,function(e){var t=m[e];console.assert(t,"No such listener: "+e),p.splice(t,1),delete m[e],console.log("Stopped listening for "+e)}(this.name()),function(e){var t=w[e];console.assert(t,"No such listener: "+e),k.splice(t,1),delete w[e],console.log("Stopped listening for "+e)}(this.name()),this.stopListeningForMouseEvents(),this._chunkRenderer.dispose(),this._tileMaterials.dispose(),this._objects.dispose(),this._objectMaterials.dispose(),this._renderer.dispose(),this._map=null,this._chunkRenderer=null,this._scene=null,this._renderer=null}},{key:"centerCameraOnTile",value:function(e,t){console.assert(e>=0),console.assert(t>=0),console.assert(e<E),console.assert(t<L);var n=Math.floor(e/16),i=Math.floor(t/16),s=this._chunkRenderer.chunksWide(),a=this._chunkRenderer.chunksHigh(),r=Math.min(Math.max(0,n-Math.floor(s/2)),32),o=Math.min(Math.max(0,i-Math.floor(a/2)),L);this._chunkRenderer.setLeftTop(r,o),this._objects.offsetForChunkRenderer(this._chunkRenderer),this._cameraDelta.x=0,this._cameraDelta.y=0,this._cameraWorldTile.x=e,this._cameraWorldTile.y=t;var h=this.sceneCoordinateForWorldTile(e,t),c=h.sceneX,u=h.sceneY;this._camera.position.x=c-Math.round(this.width()/2),this._camera.position.y=u-Math.round(this.height()/2)}},{key:"sceneCoordinateForWorldTile",value:function(e,t){var n=this._chunkRenderer.left(),i=this._chunkRenderer.top();return{sceneX:e*M-n*C,sceneY:t*M-i*C}}},{key:"worldTileForSceneCoordinate",value:function(e,t){var n=this._chunkRenderer.left()*C,i=this._chunkRenderer.top()*C;return{x:(e+n)/M,y:(this._chunkRenderer.sceneDimensions().height-t+i)/M}}},{key:"toggleRendering",value:function(){this._rendering?this.stopRendering():this.startRendering()}},{key:"startRendering",value:function(){this._rendering?console.warn("Attempt to start rendering while already started."):(console.log("Rendering started."),this._rendering=!0,this._renderer.setAnimationLoop(this.render))}},{key:"stopRendering",value:function(){this._rendering?this._rendering=!1:console.warn("Attempt to stop rendering twice.")}},{key:"start",value:function(){var e,t;e=this.name(),t=this.resize,p.push(t),m[e]=p.length-1,console.log("Started listening: "+e),t(g,v),function(e,t){k.push(t),w[e]=k.length-1,console.log("Started listening: "+e)}(this.name(),this.keydown),this.listenForMouseEvents();var n=Math.floor(E/2),i=Math.floor(L/2);this.centerCameraOnTile(n,i),this.startRendering()}},{key:"_applyCameraDelta",value:function(){var e=this._cameraDelta.x,t=this._cameraDelta.y;if(e||t){var n=this._camera.position,i=n.x,s=n.y;i+=e;var a=!1;(s+=t)>this._panBoundary.top?this._chunkRenderer.panUp()?(s-=this._panBoundary.offset,a=!0):s>this._offMapBoundary.top&&(s=this._offMapBoundary.top):s<this._panBoundary.bottom&&(this._chunkRenderer.panDown()?(s+=this._panBoundary.offset,a=!0):s<this._offMapBoundary.bottom&&(s=this._offMapBoundary.bottom)),i>this._panBoundary.right?this._chunkRenderer.panRight()?(i-=this._panBoundary.offset,a=!0):i>this._offMapBoundary.right&&(i=this._offMapBoundary.right):i<this._panBoundary.left&&(this._chunkRenderer.panLeft()?(i+=this._panBoundary.offset,a=!0):i<this._offMapBoundary.left&&(i=this._offMapBoundary.left)),this._cameraDelta.x=0,this._cameraDelta.y=0,this._cameraWorldTile.x+=e/M,this._cameraWorldTile.y+=t/M,this._camera.position.x=i,this._camera.position.y=s,a&&(this._chunkRenderer.reorientChunks(),this._objects.offsetForChunkRenderer(this._chunkRenderer))}}}]),e}();F._rendererCount=0,F.KEY_JUMP_SIZE=C,F.RENDERER_OPTIONS={antialias:!1,stencil:!1};var X=null;var K=n(18);function J(){var e=Object(_.a)(["\n  display: block;\n"]);return J=function(){return e},e}var Z=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).ref=s.a.createRef(),n}return Object(l.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e;e=this.ref.current,X&&console.warn("Overriding renderer."),(X=new F(e)).generateMap(),X.start()}},{key:"componentWillUnmount",value:function(){console.warn("Unmounting <Display />! This may indicate a problem."),X&&X.destroy()}},{key:"render",value:function(){return s.a.createElement("canvas",{id:"game",className:this.props.className,ref:this.ref})}}]),t}(s.a.Component),q=Object(K.a)(Z)(J());function Q(){return s.a.createElement("div",null,s.a.createElement("p",null,"Couldn't initialize renderer. Check the console."))}var $=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){t.RUN&&(D.showPanel(0),document.body.append(D.dom),P||console.warn("OffscreenCanvas() not found!"),U||console.warn("WebGL 2.0 not supported!"))}},{key:"render",value:function(){return s.a.createElement("div",{className:"App"},t.RUN?s.a.createElement(q,null):s.a.createElement(Q,null))}}]),t}(i.Component);$.RUN=!!I||(console.error("WebGL not supported."),!1);var V=$;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(V,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[22,1,2]]]);
//# sourceMappingURL=main.beec6122.chunk.js.map